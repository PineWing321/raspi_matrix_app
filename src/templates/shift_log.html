{% extends "base.html"%}

{% block title %}
<hgroup style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Shift Details</h2>
    <a href="/" style="text-decoration: none; color: #0077b6; font-weight: bold;">← Back To Overview</a>
</hgroup>
{% endblock %}

{% block content %}
<article style="max-width: 960px; margin: 2rem auto; background: #fff; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

    <h3 style="text-align: center; margin-bottom: 1.5rem;">Shift Logs for {{ date }}</h3>

    <table style="width: 100%; border-collapse: collapse; text-align: center;">
        <thead style="background-color: #f0f0f0;">
            <tr>
                <th style="padding: 10px; font-weight: bold;">Start Time</th>
                <th style="padding: 10px; font-weight: bold;">Stop Time</th>
                <th style="padding: 10px; font-weight: bold;">Reason</th>
                <th style="padding: 10px; font-weight: bold;">Cause</th>
                <th style="padding: 10px; font-weight: bold;">Comments</th>
                <th style="padding: 10px; font-weight: bold;">Parts</th>
            </tr>
        </thead>
        <tbody>
            {% for row in shift_logs %}
            <tr style="border-bottom: 1px solid #ddd;">
                <td style="padding: 10px;"><span class="utc-time">{{ row["start_time"] }}</span></td>
                <td style="padding: 10px;">
                    {% if row["stop_time"] %}
                    <span class="utc-time">{{ row["stop_time"] }}</span>
                    {% else %}
                    In Progress
                    {% endif %}
                </td>
                <td style="padding: 10px;">{{row["reason"] or "-"}}</td>
                <td style="padding: 10px;">{{ row["cause"] or "-" }}</td>
                <td style="padding: 10px;">{{ row["details"] or "-" }}</td>
                <td style="padding: 10px;">{{ row["part_count"] or 0 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</article>

<form method="GET" action="/one_shift_history" style="max-width: 960px; margin: 2rem auto; display: flex; justify-content: flex-start;">
    <input type="hidden" name="shift_id" value="{{ shift_id }}" />
    <input type="hidden" name="date" value="{{ date }}" />
    <button type="submit" style="padding: 10px 16px; background-color: #6c757d; color: white; border: none; border-radius: 6px; font-weight: bold;">← Back to Shift Metrics</button>
</form>

<!-- JS: Convert UTC timestamps to local time -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const spans = document.querySelectorAll(".utc-time");
        spans.forEach(span => {
            let raw = span.textContent.trim();
            if (!raw) return;

            // Fix format if missing 'T' and 'Z'
            if (!raw.includes("T")) raw = raw.replace(" ", "T");
            if (!raw.endsWith("Z")) raw += "Z";

            const date = new Date(raw);
            if (isNaN(date)) return;

            const localString = date.toLocaleString("en-US", {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });

            span.textContent = localString;
        });
    });
</script>

{% endblock %}
